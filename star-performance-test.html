<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿæ˜Ÿæ€§èƒ½æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: white;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        
        .performance-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
        }
        
        .metric {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .content {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="performance-panel">
        <div class="metric">FPS: <span id="fps">--</span></div>
        <div class="metric">æ˜Ÿæ˜Ÿæ•°é‡: <span id="star-count">--</span></div>
        <div class="metric">å¯è§æ˜Ÿæ˜Ÿ: <span id="visible-stars">--</span></div>
        <div class="metric">å†…å­˜ä½¿ç”¨: <span id="memory">--</span></div>
        <div class="metric">æ¸²æŸ“æ—¶é—´: <span id="render-time">--</span>ms</div>
    </div>

    <div class="content">
        <h1>ğŸŒŸ é«˜å¯†åº¦æ˜Ÿæ˜Ÿæ€§èƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§</h2>
            <ul>
                <li>âœ… åˆ†æ‰¹åˆ›å»ºæ˜Ÿæ˜Ÿ (æ¯æ‰¹50ä¸ª)</li>
                <li>âœ… Intersection Observer è™šæ‹ŸåŒ–</li>
                <li>âœ… GPU åŠ é€ŸåŠ¨ç”»</li>
                <li>âœ… æ™ºèƒ½å¤§å°åˆ†å±‚ç³»ç»Ÿ</li>
                <li>âœ… è‡ªé€‚åº”æ€§èƒ½è°ƒæ•´</li>
                <li>âœ… é«˜å¯†åº¦å‘å…‰æ•ˆæœ</li>
                <li>ğŸŒŸ åŠ¨æ€4åŒºé—´å¾ªç¯é—ªçƒ</li>
                <li>ğŸŒŸ éšæœºæ˜Ÿæ˜Ÿé‡æ–°åˆ†é…</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>æµ‹è¯•æ§åˆ¶</h2>
            <button onclick="testPerformance()">å¼€å§‹æ€§èƒ½æµ‹è¯•</button>
            <button onclick="toggleStars()">åˆ‡æ¢æ˜Ÿæ˜Ÿæ˜¾ç¤º</button>
            <button onclick="adjustDensity('increase')">å¢åŠ å¯†åº¦</button>
            <button onclick="adjustDensity('decrease')">å‡å°‘å¯†åº¦</button>
            <button onclick="showStarInfo()">æ˜¾ç¤ºæ˜Ÿæ˜Ÿä¿¡æ¯</button>
            <br><br>
            <h3>ğŸŒŸ åŠ¨æ€é—ªçƒæ§åˆ¶</h3>
            <button onclick="toggleDynamicTwinkling()">åˆ‡æ¢åŠ¨æ€é—ªçƒ</button>
            <button onclick="redistributeStars()">é‡æ–°åˆ†é…æ˜Ÿæ˜Ÿ</button>
            <button onclick="showRegionInfo()">æ˜¾ç¤ºåŒºé—´ä¿¡æ¯</button>
            <button onclick="adjustTwinklingSpeed('faster')">åŠ å¿«é—ªçƒ</button>
            <button onclick="adjustTwinklingSpeed('slower')">å‡æ…¢é—ªçƒ</button>
        </div>

        <div class="test-section">
            <h2>æ»šåŠ¨æµ‹è¯•åŒºåŸŸ</h2>
            <p>æ»šåŠ¨æ­¤é¡µé¢æ¥æµ‹è¯•æ˜Ÿæ˜Ÿçš„è™šæ‹ŸåŒ–æ•ˆæœå’Œæ€§èƒ½è¡¨ç°ã€‚</p>
            <div style="height: 2000px; background: linear-gradient(to bottom, transparent, rgba(255,255,255,0.1));">
                <p style="margin-top: 500px;">ä¸­é—´åŒºåŸŸ</p>
                <p style="margin-top: 500px;">ç»§ç»­æ»šåŠ¨...</p>
                <p style="margin-top: 500px;">åº•éƒ¨åŒºåŸŸ</p>
            </div>
        </div>
    </div>

    <script>
        // æ€§èƒ½ç›‘æ§
        let frameCount = 0;
        let lastTime = performance.now();
        let fps = 0;

        function updatePerformanceMetrics() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime - lastTime >= 1000) {
                fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                document.getElementById('fps').textContent = fps;
                frameCount = 0;
                lastTime = currentTime;
            }

            // æ›´æ–°æ˜Ÿæ˜Ÿç»Ÿè®¡
            if (window.starsBackground) {
                document.getElementById('star-count').textContent = window.starsBackground.stars.length;
                
                const visibleStars = window.starsBackground.stars.filter(star => 
                    star.style.display !== 'none' && !star.classList.contains('virtualized')
                ).length;
                document.getElementById('visible-stars').textContent = visibleStars;
            }

            // å†…å­˜ä½¿ç”¨ (å¦‚æœæ”¯æŒ)
            if (performance.memory) {
                const memoryMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                document.getElementById('memory').textContent = memoryMB + ' MB';
            }

            requestAnimationFrame(updatePerformanceMetrics);
        }

        function testPerformance() {
            console.log('å¼€å§‹æ€§èƒ½æµ‹è¯•...');
            const startTime = performance.now();
            
            // æ¨¡æ‹Ÿé«˜è´Ÿè½½æ“ä½œ
            for (let i = 0; i < 1000; i++) {
                const div = document.createElement('div');
                div.style.transform = `translate(${Math.random() * 100}px, ${Math.random() * 100}px)`;
                document.body.appendChild(div);
                document.body.removeChild(div);
            }
            
            const endTime = performance.now();
            document.getElementById('render-time').textContent = Math.round(endTime - startTime);
        }

        function toggleStars() {
            if (window.starsBackground) {
                const container = window.starsBackground.container;
                container.style.display = container.style.display === 'none' ? '' : 'none';
            }
        }

        function adjustDensity(action) {
            if (window.starsBackground) {
                window.starsBackground.adaptivePerformanceAdjustment(action === 'increase' ? 'restore' : 'reduce');
            }
        }

        function showStarInfo() {
            if (window.starsBackground) {
                console.log('æ˜Ÿæ˜Ÿç³»ç»Ÿä¿¡æ¯:', {
                    æ€»æ•°é‡: window.starsBackground.stars.length,
                    æ€§èƒ½ç­‰çº§: window.starsBackground.performanceLevel,
                    é…ç½®: window.starsBackground.getStarLayerConfig(),
                    åŠ¨æ€é—ªçƒ: window.starsBackground.config.dynamicTwinkling
                });
            }
        }

        // åŠ¨æ€é—ªçƒæ§åˆ¶å‡½æ•°
        function toggleDynamicTwinkling() {
            if (window.starsBackground) {
                const config = window.starsBackground.config.dynamicTwinkling;
                config.enabled = !config.enabled;

                if (config.enabled) {
                    window.starsBackground.initializeDynamicTwinkling();
                    console.log('åŠ¨æ€é—ªçƒå·²å¯ç”¨');
                } else {
                    window.starsBackground.stop();
                    window.starsBackground.start();
                    console.log('åŠ¨æ€é—ªçƒå·²ç¦ç”¨');
                }
            }
        }

        function redistributeStars() {
            if (window.starsBackground && window.starsBackground.redistributeStarsToRegions) {
                window.starsBackground.redistributeStarsToRegions();
                console.log('æ˜Ÿæ˜Ÿå·²é‡æ–°éšæœºåˆ†é…åˆ°4ä¸ªåŒºé—´');
            }
        }

        function showRegionInfo() {
            if (window.starsBackground && window.starsBackground.starRegions) {
                const regions = window.starsBackground.starRegions;
                console.log('åŒºé—´ä¿¡æ¯:', {
                    åŒºé—´0: regions[0].length + 'ä¸ªæ˜Ÿæ˜Ÿ',
                    åŒºé—´1: regions[1].length + 'ä¸ªæ˜Ÿæ˜Ÿ',
                    åŒºé—´2: regions[2].length + 'ä¸ªæ˜Ÿæ˜Ÿ',
                    åŒºé—´3: regions[3].length + 'ä¸ªæ˜Ÿæ˜Ÿ',
                    å½“å‰æ´»è·ƒåŒºé—´: window.starsBackground.currentActiveRegion
                });
            }
        }

        function adjustTwinklingSpeed(direction) {
            if (window.starsBackground) {
                const config = window.starsBackground.config.dynamicTwinkling;

                if (direction === 'faster') {
                    config.staggerDelay = Math.max(1000, config.staggerDelay - 500);
                    config.fadeTransition = Math.max(500, config.fadeTransition - 200);
                } else {
                    config.staggerDelay = Math.min(5000, config.staggerDelay + 500);
                    config.fadeTransition = Math.min(3000, config.fadeTransition + 200);
                }

                console.log('é—ªçƒé€Ÿåº¦å·²è°ƒæ•´:', {
                    åŒºé—´é—´éš”: config.staggerDelay + 'ms',
                    æ·¡å…¥æ·¡å‡º: config.fadeTransition + 'ms'
                });

                // é‡å¯åŠ¨æ€é—ªçƒä»¥åº”ç”¨æ–°è®¾ç½®
                if (config.enabled) {
                    window.starsBackground.stop();
                    setTimeout(() => {
                        window.starsBackground.start();
                        window.starsBackground.initializeDynamicTwinkling();
                    }, 100);
                }
            }
        }

        // å¯åŠ¨æ€§èƒ½ç›‘æ§
        requestAnimationFrame(updatePerformanceMetrics);
    </script>
</body>
</html>
